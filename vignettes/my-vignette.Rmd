---
title: "aweSOM vignette"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{my-vignette}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
library(aweSOM)
library(kohonen)
```


__aweSOM__ consists of a variety of functions to visualize and assess the quality of self-organizing Kohonen map (SOM) (based on the kohonen package), and provides an shiny application for these purposes, too. This vignette explains the functions of the aweSOM package along the workflow of training a SOM, assessing its quality measures and visualizing both the SOM as well superclusters within it.  





## Creating a dataset and training a self-organizig map
For the purpose of this walkthrough the iris dataset is used to train a SOM of a 4x4 dimension. Before training the SOM using the kohonen::som function, an initial grid is approximated using principal component analysis (PCA) to improve convergence and fit of the kohonen::som function. In this example we use a hexagonal SOM grid. 


```{r}
ok.data <- iris
## Select variables
dat <- ok.data[,c("Sepal.Length", "Sepal.Width",  "Petal.Length", "Petal.Width" )]
### Scale training data
dat <- scale(dat)
### Initialization (PCA grid)
data.pca <- prcomp(dat, center= F, scale.= F)
init.x <- seq(from= quantile(data.pca$x[,1], .025), 
              to= quantile(data.pca$x[,1], .975), length.out= 4)
init.y <- seq(from= quantile(data.pca$x[,2], .025), 
              to= quantile(data.pca$x[,2], .975), length.out= 4)
init.base <- as.matrix(expand.grid(x= init.x, y= init.y))
init <- tcrossprod(init.base, data.pca$rotation[, 1:2])
## Train SOM
ok.som <- kohonen::som(dat, grid = kohonen::somgrid(4, 4, 'hexagonal'), rlen = 100, alpha = c(0.05, 0.01),
                       radius = c(6.08,-6.08), init = init, dist.fcts = 'sumofsquares')
```




## Evaluate Quality 

aweSOM provides a specific function that returns quality measures of SOM object (based on the kohonen package). In particular, quantization error, the percentage of explained variance, the topographic error and the Kaski-Lagus error are calculated as well as the number of obs. per SOM cell. 


```{r}
aweSOM::somQuality(ok.som = ok.som, traindat = dat)
```



## Superclasses of SOM

One particular feature of aweSOM is to integrate superclasses based on the SOM cells into visualizations and analysis of SOM. Inbuilt functions of aweSOM are in particular suited to hierarchical clustering and PAM (k-medoids).  This vignette covers the application of both methods for further integration into the aweSOM package. \newline
PAM clustering on the SOM cells can be achieved using the following code.
```{r}
superclust_pam <- cluster::pam(ok.som$codes[[1]], 3)
superclasses_pam <- unname(superclust_pam$clustering)
```

Hierarchical clustering  on the SOM cells can be achieved using the following code.
```{r}
superclust_hclust <- hclust(dist(ok.som$codes[[1]]), 'ward.D2')
superclasses_hclust <-  unname(superclust_hclust$clustering)
```

### Quality of superclass clustering

aweSOM provides inbuilt functions to create three different plots that allow assessing the quality of both types of clustering: aweSOMdendrogram, aweSOMscreeplot, and aweSOMsilhouette. 

###  aweSOMdendrogram
aweSOMdendrogram returns a dendogram for hierarchical clustering performed on an SOM object. For the example below, the hierarchical clustering performed in the previous section is used and 2 superclasses are visualized. This function is only valid for hierarchical clustering.
```{r}
aweSOM::aweSOMdendrogram(ok.som = ok.som, ok.hclust = superclust_hclust, 
                         input_kohSuperclass = 2)
```


### aweSOMscreeplot
aweSOMscreeplot [tbd]

```{r}
aweSOM::aweSOMscreeplot(ok.som = ok.som, method = 'hierarchical', 
                        hmethod = 'ward.D2', nclass = 2)
```

### aweSOMsilhouette
aweSOMsilhouette returns a silhouette for PAM clustering performed on an SOM object. For the example below, the PAM clustering is performed in the previous section.  This function is only valid for PAM clustering.


```{r}
aweSOM::aweSOMsilhouette(ok.som, superclasses_pam)
```




## Visualizing SOM with aweSOM

aweSOM provides multiple types of interactive and static visualizations for SOM. While the aweSOM shiny widget (launched using aweSOM::aweSOM()), several functions in the aweSOM package allow reproducing these visualizations. Interactive visualizations of SOM are part of the aweSOMplot function that will be explained in the next section. Additionally, aweSOM provides functions to create smooth distance plots of SOM (aweSOMsmoothdist) and abstraction plots (aweSOMabstraction). 


### aweSOMplot
aweSOMplot creates a variety of different interactive SOM visualizations. Using the _graphType_ argument to the function, one the following types of plots can be created:

* Hitmap: visualizes the number of observation per cell using respectively sized hexagons/rectangles.
* Radar, Barplot, Boxplot, Line, Camembert : visualizes the numeric value of each variable per cell using by the respective type of chart.
* Camembert [other to be added]: visualizes factor-level variables of each variable per cell using by the respective type of chart.




Thus, using 'Hitmap' as the argument for _graphType_ generates an interactive Hitmap that displays the distribution of observations on the SOM. _ok.sc_ is used to pass superclasses that are visualized. 

```{r}
aweSOM::aweSOMplot(ok.som = ok.som, ok.sc = superclasses_pam, ok.data = ok.data,
                   graphType = 'Hitmap', 
                   plotSize = 200)
```






In particular focussing on the plot types that visualize variables per cell, further arguments can be used to specify. 

* _plotNames_: 
* _constrast_ 
* _average_format_
* _plotVarMult_: 
* _plotOutliers_:
* _plotEqualSize_:
* _plotSize_:
* _palsc_:
* _palplot_: 
* _plotRevPal_: 


Additionally, _omitRows_ can be used an argument to omit certain rows in the ok.data object that should be omitted from being included in the visualization.  




```{r}
aweSOM::aweSOMplot(ok.som = ok.som, ok.sc = superclasses_pam, ok.data = ok.data,
                   graphType = 'Barplot',  
                   plotVarMult = c("Sepal.Length", "Sepal.Width",  
                                   "Petal.Length", "Petal.Width"),  
                   plotSize = 100)



```




### aweSOMsmoothdist





### aweSOMabstraction